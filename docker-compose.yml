services:
  mock-ecu:
    build: .
    container_name: mock-obd-ecu
    network_mode: host
    privileged: true
    command: python mock_ecu_v2.py
    restart: unless-stopped
    environment:
      - CONTROL_API_PORT=5001  # Changed from 5000 to avoid conflicts
    ports:
      - "5001:5001"  # Control API (changed from 5000)

  elm327-emulator:
    build: .
    container_name: mock-obd-elm327
    network_mode: host
    privileged: true
    command: python elm327_emulator.py --host 0.0.0.0 --port 35000
    depends_on:
      - mock-ecu
    restart: unless-stopped
    ports:
      - "35000:35000"

  test-client:
    build: .
    container_name: mock-obd-client
    network_mode: host
    privileged: true
    command: python test_client.py
    depends_on:
      - mock-ecu
    profiles:
      - testing
